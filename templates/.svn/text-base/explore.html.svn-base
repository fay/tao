{% extends "base.html" %}
{% load viewtool %}
{% block css %}
			
{% endblock %}
{% block content %}

<div class="explore">
	<div class="main">
		<div class="new_activities">
			<div class="groups">
				<h4>实时动态</h4>
				{%for activity in activities%}
				{%include 'entry.html'%}
				{%endfor%}
			</div>
			<div id="douban" class="douban_news">
				<h4>豆瓣</h4>
				{%for activity in douban_acts%}
				{%include 'entry.html'%}
				{%endfor%}
			</div>
		</div>
	</div>
	<div class="sidebar">
		<div class="updated_users">
			<!--<h4>大家的集体心跳</h4>
			{{stat_img|safe}}
			<h4>数据</h4>
			<ul>
				<li>活动({{all_count}})</li>
			</ul>-->
			<h4>最近活跃的流</h4>
			<div>
			<ul>
			{%for stream in updated_users%}
				<li><a href="/user/{{stream.who}}/{{stream.service.service}}/">{{stream.who}}@{{stream.service.service_name}}</a></li>
			{%endfor%}
			</ul>
			</div>
		</div>
	</div>
	<div class="none"></div>
</div>
		<script  type="text/javascript">
				var douban = document.getElementById('douban');
				var pics = document.getElementsByName('pic');
				for(var i = 0;i < pics.length;i++){
					var pic = pics[i];
					generatePic(pic.getAttribute('link'),pic);
				}
				function generatePic(link,pic){
					if(pic.parentNode.parentNode.parentNode.getAttribute('id') != 'douban'){
						return;
					}
					var pattern =  /\/(\w+)\/(\w+)/;
					var result = pattern.exec(link);
					$.getJSON('http://doubanhub.appspot.com/hub?type=' + result[1] + '&id=' + result[2] + '&callback=?', function(data) {
					if (pic.innerHTML == ''){
						pic.innerHTML = "<a href='" +data.alternate + "'><img src='" + data.image + "'/></a>";
					}
				});}
				</script>
<div class="paginator">
	{% autoescape off %}
		{{paginator}}
	{% endautoescape %}
</div>
{% endblock %}